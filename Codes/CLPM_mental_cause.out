> rm(list = ls())
> 
> ## load packages
> library(dpm)
Loading required package: lavaan
This is lavaan 0.6-17
lavaan is FREE software! Please report any bugs.
> library(fastDummies)
Thank you for using fastDummies!
To acknowledge our work, please cite the package:
Kaplan, J. & Schlegel, B. (2023). fastDummies: Fast Creation of Dummy (Binary) Columns and Rows from Categorical Variables. Version 1.7.1. URL: https://github.com/jacobkap/fastDummies, https://jacobkap.github.io/fastDummies/.
> library(dplyr)

Attaching package: 'dplyr'

The following objects are masked from 'package:stats':

    filter, lag

The following objects are masked from 'package:base':

    intersect, setdiff, setequal, union

> 
> ## read cleaned data
> ## setwd("~/Dropbox/RA Linsey/NLSY97/precarious/Cleaned Data")
> setwd("/scratch/wj2068/precarious")
> df <- read.csv("master_01.csv")
> df <- df %>% dplyr::select(-c(X))
> 
> ## within-industry change
> df <- df %>%
+   group_by(industry) %>%
+   mutate(education = education - mean(education,na.rm=T),
+          income = income - mean(income,na.rm=T),
+          spouse.precarious = spouse.precarious - mean(spouse.precarious,na.rm=T),
+          child.exist = child.exist - mean(child.exist,na.rm=T),
+          urban = urban - mean(urban,na.rm=T),
+          union = union - mean(union,na.rm=T)
+   )
> 
> ## within-occupation change
> df <- df %>%
+   group_by(occupation) %>%
+   mutate(education = education - mean(education,na.rm=T),
+          income = income - mean(income,na.rm=T),
+          spouse.precarious = spouse.precarious - mean(spouse.precarious,na.rm=T),
+          child.exist = child.exist - mean(child.exist,na.rm=T),
+          urban = urban - mean(urban,na.rm=T),
+          union = union - mean(union,na.rm=T)
+   )
> 
> df <- df %>% ungroup()
> 
> ## many models in the mental health equation are not converged
> ## I address this problem by assigning the general health value to the missing
> ## mental health value with a very small regression weight
> df <- 
+   df %>%
+   group_by(ID) %>%
+   mutate(sw = 
+            case_when(is.na(mental.pc.index) ~ 0.01,
+                      .default = sw),
+          mental.pc.index = 
+            case_when(
+              is.na(mental.pc.index) ~ ghealth,
+              .default = mental.pc.index
+            ))
> 
> ## transform the data to be analyzed by the dpm package
> df_dpm <- df
> df_dpm[which(df_dpm$year==2011),"year"]<-1
> df_dpm[which(df_dpm$year==2013),"year"]<-2
> df_dpm[which(df_dpm$year==2015),"year"]<-3
> df_dpm[which(df_dpm$year==2017),"year"]<-4
> df_dpm[which(df_dpm$year==2019),"year"]<-5
> df_dpm <- panel_data(df_dpm, id = ID, wave = year)
> 
> ## create race dummies
> df_dpm$race_black <- 0
> df_dpm[which(df_dpm$race == 1), "race_black"] <- 1
> df_dpm$race_hispanic <- 0
> df_dpm[which(df_dpm$race == 2), "race_hispanic"] <- 1
> df_dpm$race_mixed <- 0
> df_dpm[which(df_dpm$race == 3), "race_mixed"] <- 1
> df_dpm$race_white <- 0
> df_dpm[which(df_dpm$race == 4), "race_white"] <- 1
> 
> ## create controls, including dummies for industry but not occupation
> controls <-
+   c("lag(education)","education",
+     "lag(income)","income",
+     "lag(spouse.precarious)","spouse.precarious",
+     "lag(child.exist)","child.exist",
+     "lag(urban)","urban",
+     "lag(union)","union")
> 
> #####################################
> ############Mental Health############
> #####################################
> 
> #########################
> ###Health ~ Precarious###
> #########################
> 
> ## mental health ~ summative index
> treatment <-
+   c("pre(lag(precarious))", "pre(precarious)")
> variables <- c(treatment, controls)
> 
> try({
+   ## full
+   mental_0 <- 
+     dpm(
+       as.formula(paste("mental.pc.index ~ ",
+                        paste(variables, collapse = " + "),
+                        "| sex + race_black + race_hispanic + race_mixed")),
+       data = df_dpm,
+       error.inv = FALSE, information = "observed", missing = "fiml",
+       fixed.effects = TRUE, weights = sw
+     )
+   
+   ## main results
+   summary(mental_0)
+ })
Error in lav_fit_measures(object = object, fit.measures = fit.measures,  : 
  lavaan ERROR: fit measures not available if model did not converge
In addition: Warning messages:
1: Using formula(x) is deprecated when x is a character vector of length > 1.
  Consider formula(paste(x, collapse = " ")) instead. 
2: Using formula(x) is deprecated when x is a character vector of length > 1.
  Consider formula(paste(x, collapse = " ")) instead. 
3: In lavaan::lavaan(model = model$model, data = model$data, sampling.weights = weights_arg,  :
  lavaan WARNING:
    the optimizer (NLMINB) claimed the model converged, but not all
    elements of the gradient are (near) zero; the optimizer may not
    have found a local solution use check.gradient = FALSE to skip
    this check.
> 
> try({
+   ## male
+   mental_0 <- 
+     dpm(
+       as.formula(paste("mental.pc.index ~ ",
+                        paste(variables, collapse = " + "),
+                        "| race_black + race_hispanic + race_mixed")),
+       data = df_dpm[which(df_dpm$sex==1),],
+       error.inv = FALSE, information = "observed", missing = "fiml",
+       fixed.effects = TRUE, weights = sw
+     )
+   
+   ## main results
+   summary(mental_0)
+ })
MODEL INFO:
Dependent variable: mental.pc.index 
Total observations: 4493 
Complete observations: 151 
Time periods: 2 - 5 

MODEL FIT:
<U+0001D6D8><U+00B2>(101) = 1290.175
RMSEA = 0.051, 90% CI [0.049, 0.054]
p(RMSEA < .05) = 0.212
SRMR = 0.058 

|                               |   Est. |  S.E. | z val. |     p |
|:------------------------------|-------:|------:|-------:|------:|
| precarious (t - 1)            |  0.405 | 0.029 | 14.148 | 0.000 |
| precarious                    |  0.641 | 0.050 | 12.933 | 0.000 |
| education (t - 1)             | -0.036 | 0.040 | -0.913 | 0.361 |
| education                     | -0.013 | 0.033 | -0.409 | 0.682 |
| income (t - 1)                | -0.023 | 0.037 | -0.632 | 0.527 |
| income                        |  0.057 | 0.044 |  1.289 | 0.197 |
| spouse.precarious (t - 1)     | -0.037 | 0.018 | -2.051 | 0.040 |
| spouse.precarious             | -0.031 | 0.019 | -1.597 | 0.110 |
| child.exist (t - 1)           | -0.013 | 0.030 | -0.427 | 0.669 |
| child.exist                   | -0.009 | 0.033 | -0.279 | 0.780 |
| urban (t - 1)                 |  0.021 | 0.029 |  0.734 | 0.463 |
| urban                         |  0.040 | 0.038 |  1.046 | 0.295 |
| union (t - 1)                 | -0.035 | 0.037 | -0.926 | 0.354 |
| union                         |  0.034 | 0.037 |  0.921 | 0.357 |
| race_black                    | -0.387 | 0.068 | -5.692 | 0.000 |
| race_hispanic                 | -0.192 | 0.066 | -2.922 | 0.003 |
| race_mixed                    | -0.152 | 0.255 | -0.595 | 0.552 |
| mental.pc.index (t - 1)       |  0.946 | 0.072 | 13.075 | 0.000 |

Model converged after 7131 iterations
Warning messages:
1: Using formula(x) is deprecated when x is a character vector of length > 1.
  Consider formula(paste(x, collapse = " ")) instead. 
2: Using formula(x) is deprecated when x is a character vector of length > 1.
  Consider formula(paste(x, collapse = " ")) instead. 
3: In lav_data_full(data = data, group = group, cluster = cluster,  :
  lavaan WARNING:
    due to missing values, some pairwise combinations have less than
    10% coverage; use lavInspect(fit, "coverage") to investigate.
4: In lav_model_vcov(lavmodel = lavmodel, lavsamplestats = lavsamplestats,  :
  lavaan WARNING:
    The variance-covariance matrix of the estimated parameters (vcov)
    does not appear to be positive definite! The smallest eigenvalue
    (= 5.040940e-13) is close to zero. This may be a symptom that the
    model is not identified.
5: In lav_object_post_check(object) :
  lavaan WARNING: the covariance matrix of the residuals of the observed
                variables (theta) is not positive definite;
                use lavInspect(fit, "theta") to investigate.
> 
> try({
+   ## female
+   mental_0 <- 
+     dpm(
+       as.formula(paste("mental.pc.index ~ ",
+                        paste(variables, collapse = " + "),
+                        "| race_black + race_hispanic + race_mixed")),
+       data = df_dpm[which(df_dpm$sex==2),],
+       error.inv = FALSE, information = "observed", missing = "fiml",
+       fixed.effects = TRUE, weights = sw
+     )
+   
+   ## main results
+   summary(mental_0)
+ })
MODEL INFO:
Dependent variable: mental.pc.index 
Total observations: 4345 
Complete observations: 237 
Time periods: 2 - 5 

MODEL FIT:
<U+0001D6D8><U+00B2>(101) = 1599.804
RMSEA = 0.058, 90% CI [0.056, 0.061]
p(RMSEA < .05) = 0
SRMR = 0.056 

|                               |   Est. |  S.E. |  z val. |     p |
|:------------------------------|-------:|------:|--------:|------:|
| precarious (t - 1)            | -0.479 | 0.037 | -12.827 | 0.000 |
| precarious                    | -0.701 | 0.068 | -10.360 | 0.000 |
| education (t - 1)             |  0.010 | 0.044 |   0.224 | 0.823 |
| education                     |  0.062 | 0.034 |   1.839 | 0.066 |
| income (t - 1)                |  0.021 | 0.039 |   0.551 | 0.582 |
| income                        | -0.109 | 0.045 |  -2.393 | 0.017 |
| spouse.precarious (t - 1)     | -0.001 | 0.017 |  -0.087 | 0.931 |
| spouse.precarious             |  0.030 | 0.018 |   1.714 | 0.086 |
| child.exist (t - 1)           | -0.008 | 0.037 |  -0.212 | 0.832 |
| child.exist                   | -0.004 | 0.039 |  -0.102 | 0.919 |
| urban (t - 1)                 |  0.057 | 0.028 |   2.044 | 0.041 |
| urban                         | -0.009 | 0.035 |  -0.257 | 0.797 |
| union (t - 1)                 |  0.011 | 0.048 |   0.223 | 0.823 |
| union                         | -0.026 | 0.046 |  -0.567 | 0.571 |
| race_black                    |  0.216 | 0.062 |   3.487 | 0.000 |
| race_hispanic                 |  0.196 | 0.065 |   3.036 | 0.002 |
| race_mixed                    |  0.397 | 0.256 |   1.550 | 0.121 |
| mental.pc.index (t - 1)       |  0.786 | 0.067 |  11.667 | 0.000 |

Model converged after 7697 iterations
Warning messages:
1: Using formula(x) is deprecated when x is a character vector of length > 1.
  Consider formula(paste(x, collapse = " ")) instead. 
2: Using formula(x) is deprecated when x is a character vector of length > 1.
  Consider formula(paste(x, collapse = " ")) instead. 
3: In lav_model_vcov(lavmodel = lavmodel, lavsamplestats = lavsamplestats,  :
  lavaan WARNING:
    The variance-covariance matrix of the estimated parameters (vcov)
    does not appear to be positive definite! The smallest eigenvalue
    (= 3.755907e-13) is close to zero. This may be a symptom that the
    model is not identified.
4: In lav_object_post_check(object) :
  lavaan WARNING: the covariance matrix of the residuals of the observed
                variables (theta) is not positive definite;
                use lavInspect(fit, "theta") to investigate.
> 
> ## mental health ~ IRT
> treatment <-
+   c("pre(lag(Lz))", "pre(Lz)")
> variables <- c(treatment, controls)
> 
> try({
+   ## full
+   mental_0_irt <- 
+     dpm(
+       as.formula(paste("mental.pc.index ~ ",
+                        paste(variables, collapse = " + "),
+                        "| sex + race_black + race_hispanic + race_mixed")),
+       data = df_dpm,
+       error.inv = FALSE, information = "observed", missing = "fiml",
+       fixed.effects = TRUE, weights = sw
+     )
+   
+   ## main results
+   summary(mental_0_irt)
+ })
/opt/slurm/data/slurmd/job41939831/slurm_script: line 16: 1695085 Terminated              R -q -f CLPM_mental_causation.R
